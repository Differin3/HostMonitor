# План разработки системы мониторинга серверов

## 1. АРХИТЕКТУРА СИСТЕМЫ

### 1.1 Компоненты
- **Главный сервер (Master Node)**: центральный узел управления
- **Ноды (Agent Nodes)**: агенты на мониторируемых серверах
- **Веб-интерфейс**: панель управления
- **База данных**: хранение метрик и логов
- **API сервер**: REST API для взаимодействия

### 1.2 Технологический стек
- **Backend**: Python (FastAPI/Flask) + PHP (для веб-части)
- **Frontend**: HTML5, CSS3, JavaScript (React/Vue или vanilla)
- **База данных**: PostgreSQL/MySQL + InfluxDB (для временных рядов)
- **Контейнеризация**: Docker
- **Безопасность**: TLS/SSL, токены JWT, SSH туннели

## 2. МОДУЛИ СИСТЕМЫ

### 2.1 Агент на нодах (Python)
- Сбор метрик системы (CPU, RAM, диск, сеть)
- Мониторинг процессов (PID, CPU, RAM, статус)
- Мониторинг Docker контейнеров (статус, метрики, логи)
- Сбор логов
- Отправка данных на главный сервер
- Безопасное подключение через TLS

### 2.2 Главный сервер (Python + PHP)
- Прием данных от нод
- Обработка и хранение метрик
- Управление нодами
- Управление процессами (запуск, остановка, перезапуск)
- Управление Docker контейнерами (start, stop, restart, logs)
- API для веб-интерфейса
- Управление портами (firewall)

### 2.3 Веб-интерфейс (PHP + JavaScript)
- Дашборд с метриками в реальном времени
- Управление нодами
- Просмотр и управление процессами (запуск/остановка/убийство)
- Управление системными службами (systemd)
- Управление Docker контейнерами (список, запуск, остановка, логи, метрики)
- Управление портами
- Управление пользователями и группами
- Управление сетью (интерфейсы, VLAN, bonding)
- Управление хранилищем (LVM, RAID, файловые системы)
- Файловый менеджер
- Терминал в браузере
- Управление обновлениями системы
- Просмотр логов
- Алерты и уведомления
- Современный UI (Material Design/Bootstrap)

### 2.4 Безопасность
- TLS шифрование между нодами и сервером
- Аутентификация по токенам
- Авторизация пользователей
- SSH туннели для защищенного подключения

## 3. ФУНКЦИОНАЛЬНОСТЬ

### 3.1 Мониторинг
- CPU, RAM, диск, сеть
- Список процессов с деталями (PID, CPU%, RAM%, команда, пользователь)
- Docker контейнеры (статус, метрики, использование ресурсов)
- Открытые порты и их использование
- Системные логи

### 3.2 Управление
- Добавление/удаление нод
- Управление процессами (запуск, остановка, перезапуск, kill)
- Управление системными службами (systemd: start, stop, restart, enable, disable, status)
- Управление Docker контейнерами (start, stop, restart, pause, unpause, remove)
- Просмотр логов контейнеров в реальном времени
- Управление портами (открыть/закрыть)
- Просмотр кто использует порт
- Управление firewall правилами
- Управление пользователями и группами (создание, удаление, редактирование)
- Управление SSH ключами
- Управление сетевыми интерфейсами (настройка IP, VLAN, bonding, bridge)
- Управление хранилищем (LVM, RAID, монтирование, размонтирование)
- Управление обновлениями системы (проверка, установка, автоматические обновления)
- Файловый менеджер (просмотр, загрузка, скачивание, редактирование файлов)
- Терминал в браузере (выполнение команд через веб-интерфейс)

### 3.3 Логирование
- Централизованный сбор логов
- Фильтрация и поиск
- Хранение истории
- Экспорт логов
- Визуализация логов

### 3.4 Алерты и уведомления
- Настройка порогов для метрик (CPU, RAM, диск)
- Email/SMS уведомления при превышении порогов
- Уведомления о падении служб
- Уведомления о недоступности нод
- История алертов

### 3.5 Отчеты и аналитика
- Графики использования ресурсов (CPU, RAM, диск, сеть)
- Отчеты по производительности
- Статистика по процессам и контейнерам
- Экспорт отчетов (PDF, CSV)
- Сравнение метрик между нодами

## 4. СТРУКТУРА ПРОЕКТА

```
/
├── master/             # Главный сервер
│   ├── api/            # Python API
│   ├── web/            # PHP веб-интерфейс
│   └── config/         # Конфигурация
├── agent/              # Агент для нод
│   ├── collector/      # Сбор метрик
│   ├── sender/         # Отправка данных
│   └── config/         # Конфигурация
├── frontend/           # Frontend (JS/CSS)
│   ├── dashboard/      # Дашборд
│   ├── nodes/          # Управление нодами
│   ├── processes/      # Управление процессами
│   ├── services/       # Управление системными службами
│   ├── containers/     # Управление Docker контейнерами
│   ├── ports/          # Управление портами
│   ├── users/          # Управление пользователями
│   ├── network/        # Управление сетью
│   ├── storage/        # Управление хранилищем
│   ├── files/          # Файловый менеджер
│   ├── terminal/       # Терминал в браузере
│   ├── updates/        # Управление обновлениями
│   ├── logs/           # Просмотр логов
│   ├── alerts/         # Алерты и уведомления
│   └── reports/        # Отчеты и аналитика
├── database/           # SQL схемы
├── docker/             # Docker конфигурации
└── docs/               # Документация
```

## 5. ЭТАПЫ РАЗРАБОТКИ

### Этап 1: Инфраструктура
1. Настройка базы данных
2. Docker контейнеры
3. Базовая структура проекта

### Этап 2: Агент (Node Agent)
1. Сбор метрик системы
2. Мониторинг процессов
3. Мониторинг Docker контейнеров (Docker API)
4. TLS подключение к серверу
5. Отправка данных

### Этап 3: Главный сервер
1. API для приема данных
2. Обработка метрик
3. Управление нодами
4. API для управления процессами
5. API для управления Docker контейнерами
6. Безопасность (TLS, токены)

### Этап 4: Веб-интерфейс
1. Аутентификация
2. Дашборд с метриками
3. Управление нодами
4. Просмотр и управление процессами
5. Управление Docker контейнерами (UI)

### Этап 5: Управление портами
1. Сканирование портов
2. Определение процессов на портах
3. Управление firewall
4. UI для управления портами

### Этап 6: Система логов
1. Сбор логов с нод
2. Хранение и индексация
3. Поиск и фильтрация
4. UI для просмотра логов

### Этап 7: Дополнительные функции управления
1. Управление системными службами (systemd API)
2. Управление пользователями и группами
3. Управление SSH ключами
4. Управление сетевыми интерфейсами
5. Управление хранилищем (LVM, RAID)
6. Управление обновлениями системы

### Этап 8: Файловый менеджер и терминал
1. Файловый менеджер (просмотр, загрузка, скачивание)
2. Терминал в браузере (WebSocket терминал)
3. Редактор файлов

### Этап 9: Алерты и отчеты
1. Система алертов и уведомлений
2. Настройка порогов
3. Email/SMS уведомления
4. Генерация отчетов и графиков
5. Экспорт данных

### Этап 10: Полировка
1. Оптимизация производительности
2. Тестирование
3. Документация
4. Развертывание

## 6. БЕЗОПАСНОСТЬ

### 6.1 Связь нода-сервер
- TLS 1.3 шифрование
- Сертификаты для каждой ноды
- Проверка подлинности сертификатов

### 6.2 Аутентификация
- JWT токены для API
- Сессии для веб-интерфейса
- Роли пользователей (admin, viewer)

### 6.3 Защита данных
- Шифрование паролей (bcrypt)
- Защита от SQL инъекций
- CSRF защита

## 7. ТЕХНИЧЕСКИЕ ДЕТАЛИ

### 7.1 Протокол связи
- REST API для веб-интерфейса
- WebSocket для real-time обновлений
- gRPC или HTTP для агентов (с TLS)

### 7.2 Хранение данных
- PostgreSQL: конфигурация, пользователи, ноды
- InfluxDB: временные ряды метрик
- Elasticsearch: логи (опционально)

### 7.3 Развертывание
- Docker Compose для главного сервера
- Docker контейнер или systemd service для агентов
- Nginx как reverse proxy

### 7.4 Управление процессами
- Использование psutil (Python) для мониторинга процессов
- Удаленное выполнение команд через SSH или API
- Управление через systemd/supervisor для критичных процессов

### 7.5 Управление Docker
- Docker SDK для Python (docker-py)
- Подключение к Docker daemon через socket или TCP
- Мониторинг контейнеров через Docker API
- Управление образами, сетями, volumes
- Поддержка Docker Compose файлов

### 7.6 Управление системными службами
- Использование systemd через D-Bus или командную строку
- systemctl команды для управления службами
- Мониторинг статуса служб

### 7.7 Управление пользователями
- Использование Linux системных команд (useradd, usermod, userdel)
- Управление группами (groupadd, groupmod, groupdel)
- Управление SSH ключами через authorized_keys

### 7.8 Управление сетью
- Использование ip, ifconfig, nmcli для управления интерфейсами
- Настройка VLAN, bonding, bridge через netplan или NetworkManager
- Мониторинг сетевого трафика через iftop, nethogs

### 7.9 Управление хранилищем
- LVM команды (lvcreate, lvextend, lvremove)
- RAID управление через mdadm
- Монтирование/размонтирование файловых систем
- Мониторинг дисков через smartctl, df, iostat

### 7.10 Файловый менеджер
- Просмотр файловой системы через Python os/pathlib
- Загрузка файлов через веб-интерфейс
- Скачивание файлов
- Редактирование текстовых файлов
- Управление правами доступа (chmod, chown)

### 7.11 Терминал в браузере
- WebSocket терминал (xterm.js или аналоги)
- Выполнение команд через SSH или локально
- Поддержка цветного вывода
- История команд

### 7.12 Система алертов
- Проверка порогов метрик в реальном времени
- Email отправка через SMTP
- SMS через API провайдеров (Twilio и т.д.)
- Webhook уведомления
- Хранение истории алертов в БД

### 7.13 Отчеты и графики
- Использование Chart.js или D3.js для графиков
- Генерация PDF через reportlab или wkhtmltopdf
- Экспорт CSV через pandas
- Временные ряды из InfluxDB

## 8. ДОПОЛНИТЕЛЬНЫЕ ИДЕИ ИЗ ПАНЕЛЕЙ УПРАВЛЕНИЯ

### 8.1 Функции из Cockpit
- Информация о системе и оборудовании (CPU модель, RAM, диски)
- Диагностика ошибок системы (journalctl интеграция)
- Поддержка SELinux (статус, управление)
- Управление виртуальными машинами KVM (опционально)
- Интеграция с Podman (альтернатива Docker)

### 8.2 Функции из Webmin/cPanel
- Резервное копирование и восстановление
- Планировщик задач (cron управление)
- Мониторинг почтовых серверов
- Управление базами данных (MySQL, PostgreSQL)
- Управление веб-серверами (Apache, Nginx)

### 8.3 Современные функции
- Темная/светлая тема интерфейса
- Мобильная адаптация
- Мультиязычность (i18n)
- Экспорт/импорт конфигураций
- Шаблоны для быстрой настройки нод
- Автоматическое обнаружение нод в сети
- Здоровье системы (health score)
- Рекомендации по оптимизации
- История изменений (audit log)
- Двухфакторная аутентификация (2FA)
- API ключи для интеграций
- Webhook поддержка
- Интеграция с внешними системами мониторинга (Prometheus, Grafana)

### 8.4 Безопасность
- Блокировка после неудачных попыток входа
- IP whitelist/blacklist
- Сессионное управление
- Просмотр активных сессий
- Принудительный выход пользователей